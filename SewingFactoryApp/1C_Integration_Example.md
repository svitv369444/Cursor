# Пример интеграции с 1С

## Структура данных для обмена

### Product (Изделие)
```json
{
  "id": "PROD_001",
  "name": "Рубашка мужская",
  "price": 150.00,
  "description": "Рубашка мужская, размер 42",
  "category": "Рубашки",
  "complexity": 3,
  "estimatedTimeMinutes": 120,
  "isActive": true,
  "createdAt": 1640995200000,
  "updatedAt": 1640995200000
}
```

### Worker (Работник)
```json
{
  "id": "WORKER_001",
  "firstName": "Мария",
  "lastName": "Иванова",
  "middleName": "Петровна",
  "position": "Швея",
  "department": "Цех №1",
  "skillLevel": 4,
  "hourlyRate": 200.0,
  "isActive": true,
  "phone": "+7(999)123-45-67",
  "email": "maria.ivanova@factory.com",
  "hireDate": 1609459200000,
  "createdAt": 1640995200000,
  "updatedAt": 1640995200000
}
```

### WorkTask (Задание)
```json
{
  "id": "QR_TSK_001_20240101",
  "productId": "PROD_001",
  "workerId": null,
  "quantity": 10,
  "completedQuantity": 0,
  "status": "CREATED",
  "priority": 0,
  "deadline": 1641081600000,
  "startedAt": null,
  "completedAt": null,
  "createdAt": 1640995200000,
  "updatedAt": 1640995200000,
  "notes": "Срочный заказ"
}
```

## REST API Endpoints для 1С

### 1. Получение списка изделий
```
GET /api/v1/products
Response: Product[]
```

### 2. Получение изделия по ID
```
GET /api/v1/products/{id}
Response: Product
```

### 3. Получение списка работников
```
GET /api/v1/workers
Response: Worker[]
```

### 4. Получение работника по ID
```
GET /api/v1/workers/{id}
Response: Worker
```

### 5. Получение списка заданий
```
GET /api/v1/tasks
Response: WorkTask[]
```

### 6. Получение задания по QR коду
```
GET /api/v1/tasks/{qrCode}
Response: WorkTask
```

### 7. Создание нового задания
```
POST /api/v1/tasks
Body: WorkTask
Response: WorkTask
```

### 8. Обновление задания
```
PUT /api/v1/tasks/{id}
Body: WorkTask
Response: WorkTask
```

### 9. Завершение задания
```
POST /api/v1/tasks/{id}/complete
Body: {
  "completedQuantity": 10,
  "completedAt": 1641081600000,
  "workerId": "WORKER_001",
  "notes": "Задание выполнено в срок"
}
Response: {
  "success": true,
  "message": "Задание успешно завершено"
}
```

### 10. Синхронизация данных
```
POST /api/v1/sync/products
Body: Product[]
Response: { "success": true, "message": "Синхронизация завершена" }

POST /api/v1/sync/workers
Body: Worker[]
Response: { "success": true, "message": "Синхронизация завершена" }

POST /api/v1/sync/tasks
Body: WorkTask[]
Response: { "success": true, "message": "Синхронизация завершена" }
```

## Пример кода для 1С (псевдокод)

### Создание задания и генерация QR кода
```1c
Процедура СоздатьЗаданиеНаПроизводство(Изделие, Количество)
    
    НовоеЗадание = Справочники.ЗаданияНаПроизводство.СоздатьЭлемент();
    НовоеЗадание.Изделие = Изделие;
    НовоеЗадание.Количество = Количество;
    НовоеЗадание.Статус = Перечисления.СтатусыЗаданий.Создано;
    НовоеЗадание.QRКод = "QR_TSK_" + Формат(НовоеЗадание.Код, "ЧГ=0") + "_" + Формат(ТекущаяДата(), "ДФ=yyyyMMdd");
    НовоеЗадание.Записать();
    
    // Генерация QR кода для печати
    СгенерироватьQRКод(НовоеЗадание.QRКод);
    
КонецПроцедуры
```

### Обработка завершения задания
```1c
Процедура ОбработатьЗавершениеЗадания(QRКод, ВыполненноеКоличество, КодРаботника)
    
    Задание = Справочники.ЗаданияНаПроизводство.НайтиПоРеквизиту("QRКод", QRКод);
    Если Задание.Пустая() Тогда
        Возврат;
    КонецЕсли;
    
    ЗаданиеОбъект = Задание.ПолучитьОбъект();
    ЗаданиеОбъект.ВыполненноеКоличество = ВыполненноеКоличество;
    ЗаданиеОбъект.Работник = Справочники.Сотрудники.НайтиПоКоду(КодРаботника);
    ЗаданиеОбъект.ДатаЗавершения = ТекущаяДата();
    
    Если ВыполненноеКоличество >= ЗаданиеОбъект.Количество Тогда
        ЗаданиеОбъект.Статус = Перечисления.СтатусыЗаданий.Завершено;
    Иначе
        ЗаданиеОбъект.Статус = Перечисления.СтатусыЗаданий.ЧастичноВыполнено;
    КонецЕсли;
    
    ЗаданиеОбъект.Записать();
    
    // Расчет заработной платы
    РассчитатьЗаработнуюПлату(ЗаданиеОбъект);
    
КонецПроцедуры
```

### Расчет заработной платы
```1c
Процедура РассчитатьЗаработнуюПлату(Задание)
    
    Изделие = Задание.Изделие;
    Работник = Задание.Работник;
    ВыполненноеКоличество = Задание.ВыполненноеКоличество;
    
    СуммаЗаработка = Изделие.Стоимость * ВыполненноеКоличество;
    
    // Создание записи в документе "Начисление заработной платы"
    ДокументНачисления = Документы.НачислениеЗаработнойПлаты.СоздатьДокумент();
    ДокументНачисления.Дата = ТекущаяДата();
    ДокументНачисления.Сотрудник = Работник;
    ДокументНачисления.Сумма = СуммаЗаработка;
    ДокументНачисления.Основание = Задание.Ссылка;
    ДокументНачисления.Записать();
    ДокументНачисления.Провести();
    
КонецПроцедуры
```

## Настройка веб-сервиса в 1С

1. Создайте HTTP-сервис в конфигурации 1С
2. Настройте методы для каждого endpoint'а
3. Обеспечьте авторизацию (Basic Auth или Token)
4. Настройте обработку ошибок и логирование
5. Протестируйте API с помощью Postman или аналогичного инструмента

## Безопасность

- Используйте HTTPS для всех запросов
- Реализуйте авторизацию по токенам
- Ограничьте доступ к API по IP адресам
- Логируйте все операции для аудита
- Регулярно обновляйте токены доступа